<div class="fm-dashboard">
  <!-- menu lateral -->
  <app-sidebar></app-sidebar>

  <main class="fm-dashboard__content">
    <!-- Topo: botão + busca -->
    <section class="fm-students__top">
      <button
        type="button"
        class="fm-students__new-btn"
        (click)="abrirModalMatricula()"
      >
        + Matricular Aluno
      </button>

      <div class="fm-students__search">
        <input type="text" placeholder="Buscar por alunos..." />
        <button type="button" class="fm-students__search-btn">
          <img
            src="alunos_lupa.png"
            alt="Buscar"
            class="fm-students__search-icon"
          />
        </button>
      </div>
    </section>

    <!-- Grid de cards de alunos -->
    <section class="fm-students__grid">
      <app-card-aluno
        *ngFor="let aluno of alunos"
        [nome]="aluno.nome"
        [contato]="aluno.contato"
        [cpf]="aluno.cpf"
        [endereco]="aluno.endereco"
        [planoNome]="aluno.planoNome"
        (editarAluno)="abrirModalEditar(aluno)"
        (excluirAluno)="solicitarExclusao(aluno)"
      ></app-card-aluno>
    </section>
  </main>

  <!-- MODAL: Matricular / Editar aluno -->
  <div class="fm-modal-backdrop" *ngIf="modalMatriculaAberto">
    <div class="fm-modal">
      <button
        type="button"
        class="fm-modal__close"
        (click)="fecharModalMatricula()"
      >
        ×
      </button>

      <!-- título centralizado -->
      <h2 class="fm-register-section-title">
        {{ isEditMode ? 'Editar aluno' : 'Matricular novo aluno' }}
      </h2>

      <form
        class="fm-register-form"
        (ngSubmit)="salvarMatricula()"
        #formMatricula="ngForm"
      >
        <!-- Nome + Telefone -->
        <div class="fm-register-form__grid">
          <div class="fm-register-form__group">
            <label for="nome">Nome*</label>
            <input
              id="nome"
              name="nome"
              type="text"
              required
              [(ngModel)]="novoAluno.nome"
            />
          </div>

          <div class="fm-register-form__group">
            <label for="telefone">Telefone</label>
            <input
              id="telefone"
              name="telefone"
              type="text"
              [(ngModel)]="novoAluno.telefone"
            />
          </div>
        </div>

        <!-- CPF + Endereço -->
        <div class="fm-register-form__grid">
          <div class="fm-register-form__group">
            <label for="cpf">CPF</label>
            <input
              id="cpf"
              name="cpf"
              type="text"
              [(ngModel)]="novoAluno.cpf"
            />
          </div>

          <div class="fm-register-form__group">
            <label for="endereco">Endereço</label>
            <input
              id="endereco"
              name="endereco"
              type="text"
              [(ngModel)]="novoAluno.endereco"
            />
          </div>
        </div>

        <!-- Plano ocupando a linha toda -->
        <div class="fm-register-form__grid fm-register-form__grid--small">
          <div class="fm-register-form__group fm-register-form__group--full">
            <label for="plano">Plano</label>
            <select
              id="plano"
              name="plano"
              [(ngModel)]="novoAluno.idPlano"
            >
              <option [ngValue]="null">Selecione um plano</option>
              <option
                *ngFor="let p of planosDisponiveis"
                [ngValue]="p.id"
              >
                {{ p.titulo }}
              </option>
            </select>
          </div>
        </div>

        <!-- Botão principal: SALVAR -->
        <button
          type="submit"
          class="fm-register-form__button"
          [disabled]="formMatricula.invalid"
        >
          {{ isEditMode ? 'Salvar alterações' : 'Salvar' }}
        </button>
      </form>
    </div>
  </div>

  <!-- MODAL: Confirmação de exclusão -->
  <div class="fm-modal-backdrop" *ngIf="modalExcluirAberto">
    <div class="fm-modal">
      <button
        type="button"
        class="fm-modal__close"
        (click)="fecharModalExcluir()"
      >
        ×
      </button>

      <h2 class="fm-register-section-title">Excluir aluno</h2>

      <div class="fm-register-form">
        <p style="text-align: center; margin-bottom: 24px;">
          Tem certeza que deseja excluir o aluno
          <strong>{{ alunoParaExcluir?.nome }}</strong>?
        </p>

        <div
          class="fm-register-form__grid fm-register-form__grid--small"
          style="display: flex; gap: 12px; justify-content: center;"
        >
          <!-- Cancelar com mesma cor do botão de salvar -->
          <button
            type="button"
            class="fm-register-form__button"
            (click)="fecharModalExcluir()"
          >
            Cancelar
          </button>

          <!-- Excluir em vermelho -->
          <button
            type="button"
            class="fm-register-form__button"
            style="background-color: #e53935;"
            (click)="confirmarExclusao()"
          >
            Excluir aluno
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
