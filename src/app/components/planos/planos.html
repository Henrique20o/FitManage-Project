<div class="fm-dashboard">
  <!-- sidebar -->
  <app-sidebar></app-sidebar>

  <main class="fm-dashboard__content">
    <!-- botão "+ Criar um plano" -->
    <section class="fm-plans__top">
      <button
        type="button"
        class="fm-plans__new-btn"
        (click)="abrirModalPlano()"
      >
        + Criar um plano
      </button>
    </section>

    <!-- grid de cards de planos -->
    <section class="fm-plans__grid">
      <app-card-plano
        *ngFor="let plano of planos"
        [titulo]="plano.titulo"
        [descricao]="plano.descricao"
        [valor]="plano.valor"
        (editarPlano)="abrirModalEditar(plano)"
        (excluirPlano)="solicitarExclusao(plano)"
      ></app-card-plano>
    </section>
  </main>

  <!-- MODAL: Criar / Editar plano -->
  <div class="fm-modal-backdrop" *ngIf="modalPlanoAberto">
    <div class="fm-modal">
      <button
        type="button"
        class="fm-modal__close"
        (click)="fecharModalPlano()"
      >
        ×
      </button>

      <!-- título centralizado -->
      <h2 class="fm-register-section-title">
        {{ isEditMode ? 'Editar plano' : 'Criar novo plano' }}
      </h2>

      <form
        class="fm-register-form"
        (ngSubmit)="salvarPlano()"
        #formPlano="ngForm"
      >
        <!-- Nome do plano -->
        <div class="fm-register-form__grid fm-register-form__grid--small">
          <div class="fm-register-form__group fm-register-form__group--full">
            <label for="nomePlano">Nome do plano*</label>
            <input
              id="nomePlano"
              name="nomePlano"
              type="text"
              required
              [(ngModel)]="novoPlano.titulo"
            />
          </div>
        </div>

        <!-- Descrição -->
        <div class="fm-register-form__grid fm-register-form__grid--small">
          <div class="fm-register-form__group fm-register-form__group--full">
            <label for="descricaoPlano">Descrição</label>
            <textarea
              id="descricaoPlano"
              name="descricaoPlano"
              rows="3"
              [(ngModel)]="novoPlano.descricao"
            ></textarea>
          </div>
        </div>

        <!-- Valor -->
        <div class="fm-register-form__grid fm-register-form__grid--small">
          <div class="fm-register-form__group fm-register-form__group--full">
            <label for="valorPlano">Valor</label>
            <input
              id="valorPlano"
              name="valorPlano"
              type="text"
              [(ngModel)]="novoPlano.valor"
            />
          </div>
        </div>

        <!-- Botão principal: SALVAR -->
        <button
          type="submit"
          class="fm-register-form__button"
          [disabled]="formPlano.invalid"
        >
          {{ isEditMode ? 'Salvar alterações' : 'Salvar' }}
        </button>
      </form>
    </div>
  </div>

  <!-- MODAL: Confirmação de exclusão -->
  <div class="fm-modal-backdrop" *ngIf="modalExcluirAberto">
    <div class="fm-modal">
      <button
        type="button"
        class="fm-modal__close"
        (click)="fecharModalExcluir()"
      >
        ×
      </button>

      <h2 class="fm-register-section-title">Excluir plano</h2>

      <div class="fm-register-form">
        <p style="text-align: center; margin-bottom: 24px;">
          Tem certeza que deseja excluir o plano
          <strong>{{ planoParaExcluir?.titulo }}</strong>?
        </p>

        <div
          class="fm-register-form__grid fm-register-form__grid--small"
          style="display: flex; gap: 12px; justify-content: center;"
        >
          <button
            type="button"
            class="fm-register-form__button"
            style="background-color: #16b488; color: #333;"
            (click)="fecharModalExcluir()"
          >
            Cancelar
          </button>

          <button
            type="button"
            class="fm-register-form__button"
            style="background-color: #e53935;"
            (click)="confirmarExclusao()"
          >
            Excluir plano
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
